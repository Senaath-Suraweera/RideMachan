<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Search - Ride Machan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../css/main.css" />
    <style>
        /* Page-specific styles */
        .search-tabs {
            display: flex;
            margin-bottom: 25px;
            background-color: white;
            border-radius: var(--radius);
            padding: 8px;
            box-shadow: var(--shadow-sm);
        }

        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
        }

        .tab-btn i {
            margin-right: 8px;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 3px 8px rgba(67, 97, 238, 0.3);
        }

        /* Main Content */
        .main-content {
            grid-column: 2;
            padding: 25px 30px;
            overflow-y: auto;
        }

        /* Search Form */
        .search-form-container {
            background-color: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text);
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 14px;
            transition: var(--transition);
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .search-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-btn i {
            margin-right: 8px;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
        }

        /* Filters */
        .filters-container {
            background-color: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 25px;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-select {
            padding: 10px 12px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 14px;
            transition: var(--transition);
            background-color: white;
        }

        .apply-btn {
            background: linear-gradient(135deg, var(--success), #36d399);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        /* Search Results */
        .search-results {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .vehicle-card {
            background-color: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            display: grid;
            grid-template-columns: 80px 1fr auto;
            gap: 20px;
            align-items: start;
            transition: var(--transition);
            cursor: pointer;
        }

        .vehicle-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .vehicle-image {
            width: 80px;
            height: 60px;
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            font-size: 28px;
        }

        .vehicle-info h4 {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .vehicle-info h4:hover {
            color: var(--primary);
        }

        .price {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .category {
            color: var(--text-light);
            font-size: 14px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: var(--transition);
        }

        .category:hover {
            color: var(--primary);
            text-decoration: underline;
        }

        .location {
            color: var(--text-light);
            font-size: 14px;
            margin-bottom: 8px;
        }

        .rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .stars {
            display: flex;
            gap: 2px;
        }

        .stars i {
            color: #fbbf24;
            font-size: 14px;
        }

        .stars .far {
            color: #d1d5db;
        }

        .review-count {
            font-size: 12px;
            color: var(--text-light);
        }

        .features {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }

        .feature-tag {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .message-btn {
            background: linear-gradient(135deg, var(--info), var(--success));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: var(--transition);
        }

        .message-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(72, 149, 239, 0.3);
        }

        .subtitle {
            color: var(--text-light);
            font-size: 14px;
            margin-top: 5px;
        }

        .seats-info {
            color: var(--text-light);
            font-size: 14px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Include Sidebar Navigation -->
        <div id="navbar-container"></div>

        <!-- Include Header -->
        <div id="header-container"></div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Search Tabs -->
            <div class="search-tabs">
                <button class="tab-btn active" data-tab="vehicles" onclick="switchTab('vehicles')" type="button">
                    <i class="fas fa-car"></i>
                    Vehicles
                </button>
                <button class="tab-btn" data-tab="drivers" onclick="switchTab('drivers')" type="button">
                    <i class="fas fa-user"></i>
                    Drivers
                </button>
            </div>

            <!-- Search Form -->
            <div class="search-form-container">
                <h2 style="margin-bottom: 20px; color: var(--dark); font-size: 24px;">Find Your Perfect Vehicle</h2>
                <p class="subtitle" style="margin-bottom: 25px;">Search through thousands of vehicles across Sri Lanka</p>
                
                <div class="search-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vehicleType">Vehicle Type</label>
                            <select class="form-control" id="vehicleType">
                                <option value="">Select vehicle type</option>
                                <option value="car">Car</option>
                                <option value="suv">SUV</option>
                                <option value="van">Van</option>
                                <option value="truck">Truck</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="pickupLocation">From</label>
                            <select class="form-control" id="pickupLocation">
                                <option value="">Pick up location</option>
                                <option value="colombo">Colombo</option>
                                <option value="kandy">Kandy</option>
                                <option value="galle">Galle</option>
                                <option value="negombo">Negombo</option>
                                <option value="jaffna">Jaffna</option>
                                <option value="trincomalee">Trincomalee</option>
                                <option value="anuradhapura">Anuradhapura</option>
                                <option value="matara">Matara</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dropoffLocation">To</label>
                            <select class="form-control" id="dropoffLocation">
                                <option value="">Drop off location</option>
                                <option value="colombo">Colombo</option>
                                <option value="kandy">Kandy</option>
                                <option value="galle">Galle</option>
                                <option value="negombo">Negombo</option>
                                <option value="jaffna">Jaffna</option>
                                <option value="trincomalee">Trincomalee</option>
                                <option value="anuradhapura">Anuradhapura</option>
                                <option value="matara">Matara</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="fromDateTime">From Date & Time</label>
                            <input type="datetime-local" class="form-control" id="fromDateTime">
                        </div>
                        <div class="form-group">
                            <label for="toDateTime">To Date & Time</label>
                            <input type="datetime-local" class="form-control" id="toDateTime">
                        </div>
                    </div>

                    <button class="search-btn" onclick="performSearch()" type="button">
                        <i class="fas fa-search"></i>
                        <span id="searchBtnText">Search Vehicles</span>
                    </button>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters-container">
                <h3 style="margin-bottom: 20px; color: var(--dark);">Filters</h3>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label>Price Range</label>
                        <select class="filter-select" id="priceRange">
                            <option value="">Select</option>
                            <option value="0-5000">LKR 0 - 5,000</option>
                            <option value="5000-10000">LKR 5,000 - 10,000</option>
                            <option value="10000+">LKR 10,000+</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Category</label>
                        <select class="filter-select" id="category">
                            <option value="">Select</option>
                            <option value="economy">Economy</option>
                            <option value="premium">Premium</option>
                            <option value="luxury">Luxury</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Fuel Type</label>
                        <select class="filter-select" id="fuelType">
                            <option value="">Select</option>
                            <option value="petrol">Petrol</option>
                            <option value="diesel">Diesel</option>
                            <option value="hybrid">Hybrid</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>No of Seats</label>
                        <select class="filter-select" id="seats">
                            <option value="">Select</option>
                            <option value="2">2</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="7+">7+</option>
                        </select>
                    </div>
                </div>
                <button class="apply-btn" onclick="applyFilters()" type="button">Apply Filters</button>
            </div>

            <!-- Search Results -->
            <div class="search-results" id="searchResults">
                <!-- Results will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Load external components
        function loadComponent(elementId, filePath) {
            fetch(filePath)
                .then(response => response.text())
                .then(data => {
                    document.getElementById(elementId).innerHTML = data;
                    // Execute any scripts in the loaded content
                    const scripts = document.getElementById(elementId).getElementsByTagName('script');
                    for (let script of scripts) {
                        eval(script.innerHTML);
                    }
                })
                .catch(error => console.error('Error loading component:', error));
        }

        // Load navbar and header on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadComponent('navbar-container', '../components/navbar.html');
            loadComponent('header-container', '../components/header.html');
            
            // Set default datetime values
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            document.getElementById('fromDateTime').value = now.toISOString().slice(0, 16);
            document.getElementById('toDateTime').value = tomorrow.toISOString().slice(0, 16);
            
            // Load initial vehicle data
            renderVehicles(vehicleData);
        });

        // Current active tab
        let currentTab = 'vehicles';

        // Sample vehicle data with Sri Lankan content
        const vehicleData = [
            {
                id: 1,
                name: "Honda Vezel",
                price: 6500,
                company: "Premium Rentals",
                companyId: 1,
                location: "Colombo 03",
                rating: 4.7,
                reviews: 47,
                seats: 5,
                features: ["GPS Navigation", "Bluetooth", "A/C", "Leather Seats"],
                category: "premium",
                fuel: "hybrid",
                type: "suv"
            },
            {
                id: 2,
                name: "Toyota Axio",
                price: 4500,
                company: "City Car Rentals",
                companyId: 2,
                location: "Kandy",
                rating: 4.5,
                reviews: 32,
                seats: 5,
                features: ["A/C", "Bluetooth", "Power Steering"],
                category: "economy",
                fuel: "petrol",
                type: "car"
            },
            {
                id: 3,
                name: "Suzuki Alto",
                price: 3500,
                company: "Budget Wheels",
                companyId: 3,
                location: "Galle",
                rating: 4.2,
                reviews: 18,
                seats: 4,
                features: ["A/C", "Power Steering"],
                category: "economy",
                fuel: "petrol",
                type: "car"
            },
            {
                id: 4,
                name: "Toyota Hiace",
                price: 8500,
                company: "Lanka Van Hire",
                companyId: 4,
                location: "Negombo",
                rating: 4.6,
                reviews: 25,
                seats: 14,
                features: ["A/C", "GPS", "Spacious", "Bluetooth"],
                category: "premium",
                fuel: "diesel",
                type: "van"
            },
            {
                id: 5,
                name: "BMW X3",
                price: 12500,
                company: "Luxury Rides LK",
                companyId: 5,
                location: "Colombo 07",
                rating: 4.9,
                reviews: 56,
                seats: 5,
                features: ["Premium Sound", "Sunroof", "GPS", "Leather Interior"],
                category: "luxury",
                fuel: "petrol",
                type: "suv"
            },
            {
                id: 6,
                name: "Nissan Caravan",
                price: 7500,
                company: "Island Transport",
                companyId: 6,
                location: "Anuradhapura",
                rating: 4.3,
                reviews: 22,
                seats: 9,
                features: ["A/C", "GPS", "Spacious Luggage"],
                category: "premium",
                fuel: "diesel",
                type: "van"
            }
        ];

        let filteredVehicles = [...vehicleData];

        function switchTab(tab) {
            if (tab === 'drivers') {
                window.location.href = "driver_search.html";
                return;
            }

            currentTab = tab;
            
            // Update tab UI
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            const btn = document.querySelector(`[data-tab="${tab}"]`);
            if (btn) btn.classList.add('active');
            
            // Update search button text
            const searchBtnText = document.getElementById('searchBtnText');
            searchBtnText.textContent = tab === 'drivers' ? 'Search Drivers' : 'Search Vehicles';
            
            // Clear results when switching tabs
            document.getElementById('searchResults').innerHTML = '';
        }

        function performSearch() {
            if (currentTab === 'drivers') {
                window.location.href = "driver_search.html";
            } else {
                searchVehicles();
            }
        }

        function renderVehicles(vehicles) {
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = '';

            if (vehicles.length === 0) {
                resultsContainer.innerHTML = '<p style="text-align: center; color: var(--text-light); padding: 40px;">No vehicles found matching your criteria.</p>';
                return;
            }

            vehicles.forEach(vehicle => {
                const vehicleCard = document.createElement('div');
                vehicleCard.className = 'vehicle-card';
                vehicleCard.onclick = () => viewVehicle(vehicle.id);
                
                vehicleCard.innerHTML = `
                    <div class="vehicle-image">
                        <i class="fas fa-car"></i>
                    </div>
                    <div class="vehicle-info">
                        <h4 onclick="viewVehicle(${vehicle.id})">${vehicle.name}</h4>
                        <p class="price">LKR ${vehicle.price.toLocaleString()}/day</p>
                        <p class="category" onclick="viewCompany(${vehicle.companyId})">${vehicle.company}</p>
                        <p class="location">${vehicle.location}, Sri Lanka</p>
                        <div class="rating">
                            <div class="stars">
                                ${generateStars(vehicle.rating)}
                            </div>
                            <span class="review-count">${vehicle.reviews} reviews</span>
                        </div>
                        <div class="seats-info">
                            <i class="fas fa-users"></i>
                            ${vehicle.seats} seats
                        </div>
                        <div class="features">
                            ${vehicle.features.map(feature => `<span class="feature-tag">${feature}</span>`).join('')}
                        </div>
                    </div>
                    <div class="vehicle-actions">
                        <button class="message-btn" onclick="event.stopPropagation(); sendMessage(${vehicle.id})">Message</button>
                    </div>
                `;
                
                resultsContainer.appendChild(vehicleCard);
            });
        }

        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '<i class="fas fa-star"></i>';
                } else {
                    stars += '<i class="far fa-star"></i>';
                }
            }
            return stars;
        }

        function searchVehicles() {
            const vehicleType = document.getElementById('vehicleType').value;
            const pickupLocation = document.getElementById('pickupLocation').value;
            
            let results = vehicleData;
            
            if (vehicleType) {
                results = results.filter(vehicle => vehicle.type === vehicleType);
            }
            
            if (pickupLocation) {
                results = results.filter(vehicle => 
                    vehicle.location.toLowerCase().includes(pickupLocation.toLowerCase())
                );
            }
            
            filteredVehicles = results;
            renderVehicles(filteredVehicles);
        }

        function applyFilters() {
            const priceRange = document.getElementById('priceRange').value;
            const category = document.getElementById('category').value;
            const fuelType = document.getElementById('fuelType').value;
            const seats = document.getElementById('seats').value;
            
            let filtered = [...vehicleData];
            
            if (priceRange) {
                const [min, max] = priceRange.split('-');
                if (max === undefined) {
                    filtered = filtered.filter(v => v.price >= parseInt(min.replace('+', '')));
                } else {
                    filtered = filtered.filter(v => v.price >= parseInt(min) && v.price <= parseInt(max));
                }
            }
            
            if (category) {
                filtered = filtered.filter(v => v.category === category);
            }
            
            if (fuelType) {
                filtered = filtered.filter(v => v.fuel === fuelType);
            }
            
            if (seats) {
                if (seats === '7+') {
                    filtered = filtered.filter(v => v.seats >= 7);
                } else {
                    filtered = filtered.filter(v => v.seats == parseInt(seats));
                }
            }
            
            filteredVehicles = filtered;
            renderVehicles(filteredVehicles);
        }

        function viewVehicle(vehicleId) {
            sessionStorage.setItem('selectedVehicleId', vehicleId);
            sessionStorage.setItem('previousPage', 'search');
            window.location.href = "vehicle-profile.html";
        }

        function viewCompany(companyId) {
            sessionStorage.setItem('selectedCompanyId', companyId);
            sessionStorage.setItem('previousPage', 'search');
            window.location.href = "company-profile.html";
        }

        function sendMessage(vehicleId) {
            alert(`Opening message dialog for vehicle ID: ${vehicleId}`);
        }
    </script>
</body>
</html>