<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Driver Profile - Ride Machan</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../css/main.css" />
  <link rel="stylesheet" href="../css/driver-profile.css" />
</head>
<body>
  <div class="container">
    <!-- Include Sidebar Navigation -->
    <div id="navbar-container"></div>

    <!-- Include Header -->
    <div id="header-container"></div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="content-wrapper">
        <div class="breadcrumb">
          <button class="back-btn" onclick="goBack()">
            <i class="fas fa-arrow-left"></i> Back to Drivers
          </button>
        </div>

        <div class="driver-profile-container">
          <!-- Left Section - Driver Details -->
          <div class="driver-details">
            <div class="driver-header">
              <div class="driver-avatar">
                <div class="driver-avatar-img" id="driverAvatarImg">LP</div>
              </div>
              <div class="driver-info">
                <div class="driver-name">
                  <h2 id="driverName">Lasith Perera</h2>
                  <span class="verified-badge">
                    <i class="fas fa-check-circle"></i> Verified
                  </span>
                </div>
                <div class="driver-rating">
                  <div class="stars" id="driverStars">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="far fa-star"></i>
                  </div>
                  <span class="rating-text" id="ratingText">4.9 (156 reviews)</span>
                </div>
                <div class="driver-price" id="driverPrice">LKR 2,500/hour</div>
              </div>
            </div>

            <div class="driver-stats">
              <div class="stat-item">
                <i class="fas fa-map-marker-alt"></i>
                <span id="driverLocation">Colombo, Sri Lanka</span>
              </div>
              <div class="stat-item">
                <i class="fas fa-calendar-alt"></i>
                <span id="driverExperience">9 years experience</span>
              </div>
              <div class="stat-item">
                <i class="fas fa-building"></i>
                <span>Company: <span class="company-link" id="driverCompany" onclick="viewCompany()">Ceylon Elite Drivers</span></span>
              </div>
            </div>

            <div class="action-buttons">
              <button class="btn btn-primary" onclick="callDriver()">
                <i class="fas fa-phone"></i>
                <span id="callBtnText">Call +94 77 123 4567</span>
              </button>
              <button class="btn btn-outline" onclick="messageDriver()">
                <i class="fas fa-comment"></i>
                Message
              </button>
            </div>

            <div class="driver-details-sections">
              <!-- Languages -->
              <div class="detail-section">
                <h3>Languages:</h3>
                <div class="tags" id="languageTags">
                  <span class="tag">Sinhala</span>
                  <span class="tag">English</span>
                  <span class="tag">Tamil</span>
                </div>
              </div>

              <!-- Specialties -->
              <div class="detail-section">
                <h3>Specialties:</h3>
                <div class="tags" id="specialtyTags">
                  <span class="tag">Airport transfers</span>
                  <span class="tag">Long distance</span>
                  <span class="tag">City tours</span>
                </div>
              </div>

              <!-- Vehicle Types -->
              <div class="detail-section">
                <h3>Vehicle Types:</h3>
                <div class="tags" id="vehicleTags">
                  <span class="tag">Toyota Prius</span>
                  <span class="tag">Toyota Axio</span>
                  <span class="tag">Suzuki Alto</span>
                </div>
              </div>
            </div>

            <!-- Recent Reviews -->
            <div class="reviews-section">
              <h3>Recent Reviews</h3>
              <div class="review-item">
                <div class="review-header">
                  <span class="reviewer-name">Priya Fernando</span>
                  <span class="review-date">2024-02-08</span>
                </div>
                <div class="review-stars">
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                </div>
                <p class="review-text">Very friendly and punctual driver. Made the trip comfortable and safe.</p>
              </div>

              <div class="review-item">
                <div class="review-header">
                  <span class="reviewer-name">Ravi Silva</span>
                  <span class="review-date">2024-01-15</span>
                </div>
                <div class="review-stars">
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                </div>
                <p class="review-text">Clean vehicle and excellent driving skills. Highly recommended!</p>
              </div>

              <div class="review-item">
                <div class="review-header">
                  <span class="reviewer-name">Nimal Perera</span>
                  <span class="review-date">2024-01-07</span>
                </div>
                <div class="review-stars">
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="far fa-star"></i>
                </div>
                <p class="review-text">Great service, knows the routes very well. Good experience overall.</p>
              </div>
            </div>
          </div>

          <!-- Right Section - Booking -->
          <div class="booking-section">
            <div class="booking-card">
              <h3>Book This Driver</h3>

              <div class="booking-form">
                <div class="form-group">
                  <label>Select Date</label>
                  <input type="date" class="form-control" id="bookingDate" value="2024-08-15">
                </div>

                <div class="form-group">
                  <label>Select Time</label>
                  <select class="form-control" id="timeSlot">
                    <option>Choose time slot</option>
                    <option>08:00 AM</option>
                    <option>09:00 AM</option>
                    <option>10:00 AM</option>
                    <option>11:00 AM</option>
                    <option>12:00 PM</option>
                    <option>01:00 PM</option>
                    <option>02:00 PM</option>
                    <option>03:00 PM</option>
                    <option>04:00 PM</option>
                    <option>05:00 PM</option>
                  </select>
                </div>

                <div class="form-group">
                  <label>Trip Duration</label>
                  <input type="number" class="form-control" id="tripDuration" placeholder="Hours" min="1" max="24">
                </div>

                <div class="form-group">
                  <label>Select Service</label>
                  <select class="form-control" id="serviceType">
                    <option>Choose service</option>
                    <option>Airport Transfer</option>
                    <option>City Tour</option>
                    <option>Long Distance</option>
                    <option>Business Trip</option>
                    <option>Regular Service</option>
                  </select>
                </div>

                <button class="btn btn-primary btn-book" onclick="bookDriver()">
                  <i class="fas fa-calendar-check"></i> Book Now
                </button>
              </div>
            </div>

            <!-- Availability Calendar -->
            <div class="availability-section">
              <h3>Availability Calendar</h3>
              <div class="availability-info">
                <p>Green dates show when driver is available for bookings</p>
              </div>
              <div class="mini-calendar-grid">
                <div class="calendar-nav">
                  <button class="nav-btn" onclick="previousMonth()"><i class="fas fa-chevron-left"></i></button>
                  <span class="month-year">August 2024</span>
                  <button class="nav-btn" onclick="nextMonth()"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="calendar-body">
                  <span class="available">1</span>
                  <span class="available">2</span>
                  <span class="available">3</span>
                  <span class="available">4</span>
                  <span class="booked">5</span>
                  <span class="available">6</span>
                  <span class="available">7</span>
                  <span class="available">8</span>
                  <span class="available">9</span>
                  <span class="available">10</span>
                  <span class="booked">11</span>
                  <span class="available">12</span>
                  <span class="available">13</span>
                  <span class="available">14</span>
                  <span class="today available">15</span>
                  <span class="available">16</span>
                  <span class="available">17</span>
                  <span class="available">18</span>
                  <span class="available">19</span>
                  <span class="available">20</span>
                  <span class="available">21</span>
                  <span class="available">22</span>
                  <span class="available">23</span>
                  <span class="available">24</span>
                  <span class="available">25</span>
                  <span class="available">26</span>
                  <span class="available">27</span>
                  <span class="available">28</span>
                  <span class="available">29</span>
                  <span class="available">30</span>
                  <span class="available">31</span>
                </div>
              </div>
            </div>
          </div>
        </div><!-- driver-profile-container -->
      </div><!-- content-wrapper -->
    </div><!-- main-content -->
  </div><!-- container -->

  <!-- ================== SCRIPTS ================== -->
  <script>
    function loadComponent(elementId, filePath) {
            fetch(filePath)
                .then(response => response.text())
                .then(data => {
                    let modifiedData = data;
                    if (elementId === 'header-container') {
                        modifiedData = data.replace('{{PAGE_TITLE}}', 'Driver Profile');
                    }
                    document.getElementById(elementId).innerHTML = modifiedData;
                    const scripts = document.getElementById(elementId).getElementsByTagName('script');
                    for (let script of scripts) {
                        eval(script.innerHTML);
                    }
                })
                .catch(error => console.error('Error loading component:', error));
        }

        // Sample driver data with company mapping
        const driversData = [
            {
                id: 1,
                name: "Lasith Perera",
                initial: "LP",
                price: 2500,
                location: "Colombo",
                experience: 9,
                rating: 4.9,
                reviews: 156,
                languages: ["Sinhala", "English", "Tamil"],
                specialties: ["Airport transfers", "Long distance", "City tours"],
                vehicles: ["Toyota Prius", "Toyota Axio", "Suzuki Alto"],
                companyId: 1,
                company: "Premium Rentals",
                phone: "+94 77 123 4567"
            },
            {
                id: 2,
                name: "Ruwan Silva",
                initial: "RS",
                price: 2000,
                location: "Kandy",
                experience: 5,
                rating: 4.7,
                reviews: 89,
                languages: ["Sinhala", "English"],
                specialties: ["Business trips", "Event transportation"],
                vehicles: ["Honda Fit", "Toyota Axio"],
                companyId: 2,
                company: "City Car Rentals",
                phone: "+94 71 456 7890"
            },
            {
                id: 3,
                name: "Nimal Fernando",
                initial: "NF",
                price: 3200,
                location: "Galle",
                experience: 12,
                rating: 4.8,
                reviews: 203,
                languages: ["Sinhala", "English"],
                specialties: ["Tourist guide", "Cultural tours", "Photography tours"],
                vehicles: ["Toyota Vitz", "Suzuki Alto"],
                companyId: 3,
                company: "Budget Wheels",
                phone: "+94 91 234 5678"
            },
            {
                id: 4,
                name: "Asanka Jayawardena",
                initial: "AJ",
                price: 2300,
                location: "Negombo",
                experience: 6,
                rating: 4.6,
                reviews: 124,
                languages: ["Sinhala", "English"],
                specialties: ["Airport pickup", "Hotel transfers", "Beach tours"],
                vehicles: ["Honda Vezel", "Toyota Axio"],
                companyId: 1,
                company: "Premium Rentals",
                phone: "+94 31 789 0123"
            }
        ];

        let selectedDriver = null;

        function loadDriverProfile() {
            const driverId = sessionStorage.getItem('selectedDriverId') || '1';
            selectedDriver = driversData.find(d => d.id == driverId) || driversData[0];
            
            if (selectedDriver) {
                document.getElementById('driverAvatarImg').textContent = selectedDriver.initial;
                document.getElementById('driverName').textContent = selectedDriver.name;
                document.getElementById('ratingText').textContent = `${selectedDriver.rating} (${selectedDriver.reviews} reviews)`;
                document.getElementById('driverPrice').textContent = `LKR ${selectedDriver.price.toLocaleString()}/hour`;
                document.getElementById('driverLocation').textContent = `${selectedDriver.location}, Sri Lanka`;
                document.getElementById('driverExperience').textContent = `${selectedDriver.experience} years experience`;
                document.getElementById('driverCompany').textContent = selectedDriver.company;
                document.getElementById('callBtnText').textContent = `Call ${selectedDriver.phone}`;
                
                // Update stars
                const starsContainer = document.getElementById('driverStars');
                starsContainer.innerHTML = generateStars(selectedDriver.rating);
                
                // Update languages
                const languageTags = document.getElementById('languageTags');
                languageTags.innerHTML = selectedDriver.languages.map(lang => 
                    `<span class="tag">${lang}</span>`
                ).join('');
                
                // Update specialties
                const specialtyTags = document.getElementById('specialtyTags');
                specialtyTags.innerHTML = selectedDriver.specialties.map(specialty => 
                    `<span class="tag">${specialty}</span>`
                ).join('');

                // Update vehicle types
                const vehicleTags = document.getElementById('vehicleTags');
                vehicleTags.innerHTML = selectedDriver.vehicles.map(vehicle => 
                    `<span class="tag">${vehicle}</span>`
                ).join('');
            }

            // Update breadcrumb based on previous page
            const previousPage = sessionStorage.getItem('previousPage');
            const backBtn = document.querySelector('.back-btn');
            if (previousPage === 'driver_search') {
                backBtn.innerHTML = '<i class="fas fa-arrow-left"></i> Back to Drivers';
            } else {
                backBtn.innerHTML = '<i class="fas fa-arrow-left"></i> Back to Search';
            }
        }

        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= Math.floor(rating)) {
                    stars += '<i class="fas fa-star"></i>';
                } else if (i === Math.ceil(rating) && rating % 1 !== 0) {
                    stars += '<i class="fas fa-star-half-alt"></i>';
                } else {
                    stars += '<i class="far fa-star"></i>';
                }
            }
            return stars;
        }

        function selectDate(date) {
            // Remove previous selection
            document.querySelectorAll('.calendar-body span').forEach(span => {
                span.classList.remove('selected');
            });
            
            // Add selection to clicked date
            event.target.classList.add('selected');
            
            // Update date input
            document.getElementById('bookingDate').value = `2024-08-${date.toString().padStart(2, '0')}`;
        }

        function callDriver() {
            if (selectedDriver) {
                showNotification(`Calling ${selectedDriver.name} at ${selectedDriver.phone}...`, 'info');
                // In a real app, this would initiate a call
                setTimeout(() => {
                    showNotification('Call connected!', 'success');
                }, 2000);
            }
        }

        function messageDriver() {
            if (!selectedDriver) return;
            
            const popup = document.createElement('div');
            popup.className = 'popup-overlay';
            popup.innerHTML = `
                <div class="popup-content">
                    <div class="popup-header">
                        <h3>Message ${selectedDriver.name}</h3>
                        <button class="close-btn" onclick="closePopup()">&times;</button>
                    </div>
                    <div class="popup-body">
                        <div class="form-group">
                            <label>Your Message:</label>
                            <textarea class="message-input" id="messageText" placeholder="Type your message here..."></textarea>
                        </div>
                    </div>
                    <div class="popup-footer">
                        <button class="btn btn-primary" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i> Send Message
                        </button>
                        <button class="btn btn-outline" onclick="closePopup()">Cancel</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(popup);
            
            // Show popup with animation
            setTimeout(() => {
                popup.classList.add('show');
            }, 10);
            
            // Focus on textarea
            setTimeout(() => {
                document.getElementById('messageText').focus();
            }, 300);
        }

        function sendMessage() {
            const messageText = document.getElementById('messageText').value.trim();
            
            if (!messageText) {
                showNotification('Please enter a message', 'warning');
                return;
            }
            
            closePopup();
            showNotification(`Message sent to ${selectedDriver.name}!`, 'success');
        }

        function viewCompany() {
            if (selectedDriver) {
                // Store company ID and current page in sessionStorage for navigation
                sessionStorage.setItem('selectedCompanyId', selectedDriver.companyId);
                sessionStorage.setItem('previousPage', 'driver-profile');
                // Navigate to company profile page
                window.location.href = "company-profile.html";
            }
        }

        function bookDriver() {
            const date = document.getElementById('bookingDate').value;
            const time = document.getElementById('timeSlot').value;
            const duration = document.getElementById('tripDuration').value;
            const service = document.getElementById('serviceType').value;
            
            if (!date || time === 'Choose time slot' || !duration || service === 'Choose service') {
                showNotification('Please fill in all booking details', 'warning');
                return;
            }
            
            if (selectedDriver) {
                // Create booking confirmation popup
                const popup = document.createElement('div');
                popup.className = 'popup-overlay';
                popup.innerHTML = `
                    <div class="popup-content">
                        <div class="popup-header">
                            <h3>Booking Confirmation</h3>
                            <button class="close-btn" onclick="closePopup()">&times;</button>
                        </div>
                        <div class="popup-body">
                            <h4 style="margin-bottom: 15px; color: var(--success);">
                                <i class="fas fa-check-circle"></i> Booking Confirmed!
                            </h4>
                            <div style="background: var(--light); padding: 15px; border-radius: var(--radius-sm); margin-bottom: 15px;">
                                <p><strong>Driver:</strong> ${selectedDriver.name}</p>
                                <p><strong>Date:</strong> ${date}</p>
                                <p><strong>Time:</strong> ${time}</p>
                                <p><strong>Duration:</strong> ${duration} hours</p>
                                <p><strong>Service:</strong> ${service}</p>
                                <p><strong>Total Cost:</strong> LKR ${(selectedDriver.price * duration).toLocaleString()}</p>
                            </div>
                            <p style="color: var(--text-light); font-size: 14px;">
                                You will receive a confirmation SMS and email shortly. The driver will contact you 30 minutes before pickup.
                            </p>
                        </div>
                        <div class="popup-footer">
                            <button class="btn btn-primary" onclick="confirmBooking()">
                                <i class="fas fa-check"></i> Confirm Booking
                            </button>
                            <button class="btn btn-outline" onclick="closePopup()">Cancel</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(popup);
                
                // Show popup with animation
                setTimeout(() => {
                    popup.classList.add('show');
                }, 10);
            }
        }

        function confirmBooking() {
            closePopup();
            showNotification('Booking confirmed successfully! Check your email for details.', 'success');
            
            // Clear form
            document.getElementById('bookingDate').value = '';
            document.getElementById('timeSlot').selectedIndex = 0;
            document.getElementById('tripDuration').value = '';
            document.getElementById('serviceType').selectedIndex = 0;
        }

        function closePopup() {
            const popup = document.querySelector('.popup-overlay');
            if (popup) {
                popup.classList.remove('show');
                setTimeout(() => {
                    popup.remove();
                }, 300);
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification-toast ${type}`;
            
            const icon = type === 'success' ? 'check-circle' : 
                        type === 'warning' ? 'exclamation-triangle' : 
                        type === 'error' ? 'times-circle' : 'info-circle';
            
            notification.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Hide notification after 4 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        function goBack() {
            const previousPage = sessionStorage.getItem('previousPage');
            if (previousPage === 'driver_search') {
                window.location.href = "driver_search.html";
            } else if (previousPage === 'search') {
                window.location.href = "search.html";
            } else {
                // Default fallback
                window.location.href = "search.html";
            }
        }

        function goHome() {
            window.location.href = "home.html";
        }

        function goToSearch() {
            window.location.href = "search.html";
        }

        function previousMonth() {
            showNotification('Previous month navigation - feature coming soon!', 'info');
        }

        function nextMonth() {
            showNotification('Next month navigation - feature coming soon!', 'info');
        }

        // Load components and initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadComponent('navbar-container', '../components/navbar.html');
            loadComponent('header-container', '../components/header.html');
            
            // Load driver profile data after components are loaded
            setTimeout(() => {
                loadDriverProfile();
            }, 200);
        });

        // Close popup when clicking on backdrop
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('popup-overlay')) {
                closePopup();
            }
        });

        // ESC key to close popup
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closePopup();
            }
        });
    </script>
    
</body>
</html>
